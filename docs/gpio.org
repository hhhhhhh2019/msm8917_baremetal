#+title: GPIO

Тут есть 3 gpio контроллера: pinctrl, spmi-mpp и spmi-gpio.

Судя по dts у spmi-mpp и spmi-gpio нет ничего интересного(хотя в исходниках lk2nd дисплей управляется через spmi, но не факт, что я смотрел код для моего устройства)

(светодиод снизу подключен через i2c)


из документации линукса:

LOW: gpio_direction_output(gpio, 0) ... this drives the signal jand overrides the pullup.

HIGH: gpio_direction_input(gpio) ... this turns off the output, so the pullup (or some other device) controls the signal.


* Всякие константы
| имя                    |  значение | комментарии            |
|------------------------+-----------+------------------------|
| TLMM_BASE              | 0x1000000 | взято из dts           |
| REG_SIZE               |    0x1000 |                        |
|                        |           | остальное из кода ядра |
| ctl_reg_offset         |         0 |                        |
| io_reg_offset          |         4 |                        |
| intr_cfg_reg_offset    |         8 |                        |
| intr_status_reg_offset |        12 |                        |
| intr_target_reg_offset |         8 |                        |
| pull_bit               |         0 |                        |
| in_bit                 |         0 |                        |
| out_bit                |         1 |                        |
| mux_bit                |         2 |                        |
| drv_bit                |         6 |                        |
| oe_bit                 |         9 |                        |
| intr_enable_bit        |         0 |                        |
| intr_status_bit        |         0 |                        |
| intr_polarity_bit      |         1 |                        |
| intr_detection_bit     |         2 |                        |
| intr_detection_width   |         2 |                        |
| intr_target_kpss_val   |         4 |                        |
| intr_raw_status_bit    |         4 |                        |
| intr_target_bit        |         5 |                        |

* Устройства
** Flashlight
gpio90 - flash_now, gpio93 - flash_en

чтобы включить фонарик: gpio93 = output mode, 2ma, no pull, func0, enable
выключить соответственно disable

gpio90 нужен для вспышки, но я его не трогал

** Вибратор
gpio97

просто ставите out, no pull, 2ma, func0, enable
выключаете через disable
